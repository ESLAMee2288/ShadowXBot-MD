// ===========================================================
// ๐ ุชู ุงูุชุญุฏูุซ ุจูุงุณุทุฉ JoanTK
// โฆ ุงููุธููุฉ: ุจุชุชุญูู ุฅุฐุง ุงูุฌุฑูุจ ุนุฏูู ุชุงุฑูุฎ ุงูุชูุงุก ุตูุงุญูุชูุ ููู ูุนูุงู ูุฏูุ ุงูุจูุช ุจูุฎุฑุฌ ูู ุงูุฌุฑูุจ.
// โฆ ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ:
//   1. **ุงูุชุญูู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ**: ุจูุดูู ูู ุงูุชุงุฑูุฎ ุนุฏู.
//   2. **ุฅุจูุงุบ ุงูุฌุฑูุจ**: ุจูุจุนุช ุฑุณุงูุฉ ูุฏุงุน ููุง ุชูุชูู ูุฏุฉ ุงูุฅูุฌุงุฑ.
//   3. **ุชููุงุฆูุฉ**: ุงูุจูุช ุจูุฎุฑุฌ ููุญุฏู ูู ุงูุฌุฑูุจ ููุง ุงูุชุงุฑูุฎ ูุฎูุต.
//   4. **ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก**: ุฅุถุงูุงุช ุนุดุงู ุฃู ูุดููุฉ ุชุญุตู.
// ===========================================================

export async function all(m) {
  // ูุชุญูู ุฅุฐุง ุงูุฑุณุงูุฉ ุฌุงูุฉ ูู ุฌุฑูุจ
  if (!m.isGroup) return;

  // ูุฌูุจ ุจูุงูุงุช ุงูุฌุฑูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  let chats = global.db.data.chats[m.chat];

  // ูู ูููุด ุชุงุฑูุฎ ุงูุชูุงุก ูุชุณุฌูุ ูุง ูุนููุด ุญุงุฌุฉ
  if (!chats.expired) return true;

  // ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก: ูู ุญุตูุช ูุดููุฉ ุฃุซูุงุก ุงูุชูููุฐ
  try {
    // ูุชุญูู ูู ุงูุชุงุฑูุฎ ุนุฏู
    if (+new Date() > chats.expired) {
      // ุฑุณุงูุฉ ูุฏุงุน ูุฎุตุตุฉ
      let goodbyeMessage =
        chats.expiredMessage ||
        "*โจ ุฎูุงุต ูุง ุฌูุงุนุฉุ ูุฏุฉ ุงูุฅูุฌุงุฑ ุฎูุตุช! ุชูุงุตู ูุน ุงูุฃููุฑ ูู ุนุงูุฒ ุชูุฏุฏูุง ูุดูุฑ ุชุงูู. โจ*";

      // ูุจุนุช ุฑุณุงูุฉ ููุฌุฑูุจ ุฅูู ุงูุฅูุฌุงุฑ ุฎูุต
      await this.reply(m.chat, goodbyeMessage);

      // ุงูุจูุช ุจูุฎุฑุฌ ูู ุงูุฌุฑูุจ
      await this.groupLeave(m.chat);

      // ููุณุญ ุชุงุฑูุฎ ุงูุงูุชูุงุก ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
      chats.expired = null;

      // ูุฑุฌุน ุงูุฅุนุฏุงุฏ ูู ุงูุฌุฑูุจ ุฏูุน ููุฅูุฌุงุฑ ุชุงูู
      chats.expired = null;

      return true;
    }
  } catch (error) {
    console.error("๐จ ุญุตู ุฎุทุฃ ุฃุซูุงุก ุงูุชุญูู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ:", error);
    await this.reply(
      m.chat,
      "*โจ ุญุตู ุฎุทุฃ ุฃุซูุงุก ูุญุงููุฉ ุงูุชุญูู ูู ุงูุชูุงุก ูุฏุฉ ุงูุฅูุฌุงุฑ.โจ*",
    );
  }

  // ูู ูุฎูุตุด ุงูุฅูุฌุงุฑุ ูุง ูุนููุด ุญุงุฌุฉ
  return true;
}

// ุฃูุฑ ูุชุบููุฑ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุจุดูู ุฏููุงูููู (ูููู ูููู ุฏู ุจููุฏ ูููุตู)
export async function setExpiration(m, newExpirationDate) {
  let chats = global.db.data.chats[m.chat];

  try {
    // ูุญุฏุฏ ุงูุชุงุฑูุฎ ุงูุฌุฏูุฏ
    chats.expired = newExpirationDate.getTime(); // ูุถุจุท ุงูุชุงุฑูุฎ ุงูุฌุฏูุฏ
    await this.reply(
      m.chat,
      `โจ ุชู ุชุญุฏูุซ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฅูุฌุงุฑ ูู ${newExpirationDate.toString()} โจ`,
    );
  } catch (error) {
    console.error("๐จ ุญุตู ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฅูุฌุงุฑ:", error);
    await this.reply(
      m.chat,
      "*โจ ุญุตู ุฎุทุฃ ุฃุซูุงุก ูุญุงููุฉ ุชุญุฏูุซ ุชุงุฑูุฎ ุงูุฅูุฌุงุฑ.โจ*",
    );
  }
}

// ุฃูุฑ ูุฅุนุงุฏุฉ ุชุนููู ุชุงุฑูุฎ ุงูุฅูุฌุงุฑ ูู ุงุชุฌุฏุฏ ุงูุฌุฑูุจ (ุฒู ุงูุฏูุน ุฃู ุงูุชูุฏูุฏ)
export async function resetExpiration(m) {
  let chats = global.db.data.chats[m.chat];

  try {
    // ููุณุญ ุชุงุฑูุฎ ุงูุฅูุฌุงุฑ
    chats.expired = null; // ูreset ุงูุชุงุฑูุฎ
    await this.reply(m.chat, "*โจ ุชู ุชุฌุฏูุฏ ุงูุฅูุฌุงุฑุ ูุงูุฌุฑูุจ ูุณู ุดุบุงู! โจ*");
  } catch (error) {
    console.error("๐จ ุญุตู ุฎุทุฃ ุฃุซูุงุก ุฅุนุงุฏุฉ ุชุนููู ุงูุฅูุฌุงุฑ:", error);
    await this.reply(
      m.chat,
      "*โจ ุญุตู ุฎุทุฃ ุฃุซูุงุก ูุญุงููุฉ ุฅุนุงุฏุฉ ุชุนููู ุงูุฅูุฌุงุฑ.โจ*",
    );
  }
}
